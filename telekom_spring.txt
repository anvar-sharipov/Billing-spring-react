package com.WEAK.telekom.controllers;

// –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏, –∫–∞–∫ –≤ Django: from .models import Etrap
import com.WEAK.telekom.models.Etrap;

// –ò–º–ø–æ—Ä—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∫–∞–∫ –≤ Django: –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥–µ–ª–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
import com.WEAK.telekom.repositories.EtrapRepository;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

// @RestController ‚âà Django: @api_view + –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ JsonResponse
@RestController

// @RequestMapping("/api/etraps") ‚âà Django: URL path('api/etraps/', ...)
@RequestMapping("/api/etraps")

// @CrossOrigin(origins = "*") ‚âà Django: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS (django-cors-headers)
@CrossOrigin(origins = "*")
public class EtrapController {

    // @Autowired ‚âà Django: etrapRepository = Etrap.objects (–∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
    @Autowired
    private EtrapRepository etrapRepository;

    // GET /api/etraps/ ‚âà Django: Etrap.objects.all()
    @GetMapping
    public List<Etrap> getAll() {
        return etrapRepository.findAll();
    }

    // POST /api/etraps/ ‚âà Django: Etrap.objects.create()
    @PostMapping
    public Etrap create(@RequestBody Etrap etrap) {
        return etrapRepository.save(etrap);
    }

    // PUT /api/etraps/{id}/ ‚âà Django:
    // instance = get_object_or_404(Etrap, id=id)
    // instance.etrap = updated_data['etrap']
    // instance.save()
    @PutMapping("/{id}")
    public ResponseEntity<Etrap> update(@PathVariable Long id, @RequestBody Etrap updatedEtrap) {
        return etrapRepository.findById(id)
                .map(etrap -> {
                    etrap.setEtrap(updatedEtrap.getEtrap());
                    etrapRepository.save(etrap);
                    return ResponseEntity.ok(etrap);
                })
                .orElse(ResponseEntity.notFound().build());
    }

    // DELETE /api/etraps/{id}/ ‚âà Django:
    // instance = get_object_or_404(Etrap, id=id)
    // instance.delete()
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable Long id) {
        if (etrapRepository.existsById(id)) {
            etrapRepository.deleteById(id);
            return ResponseEntity.noContent().build(); // HTTP 204 No Content
        } else {
            return ResponseEntity.notFound().build(); // HTTP 404 Not Found
        }
    }
}






import React, { useEffect, useState, useRef } from "react";

const AdminEtraps = () => {
  const [etraps, setEtraps] = useState([]);
  const [newEtrap, setNewEtrap] = useState("");
  const [editPk, setEditPk] = useState(null);
  const [editName, setEditName] = useState("");

  const editInputRef = useRef(null); // üîπ –®–∞–≥ 1

  useEffect(() => {
    fetch("http://localhost:8080/api/etraps")
      .then((res) => res.json())
      .then((res) => setEtraps(res))
      .catch(console.error);
  }, []);

  useEffect(() => {
    if (editPk !== null && editInputRef.current) {
      editInputRef.current.focus();        // üîπ –§–æ–∫—É—Å
      editInputRef.current.select();       // üîπ –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    }
  }, [editPk]);

  const addNewEtrap = () => {
    if (!newEtrap.trim()) return;
    fetch("http://localhost:8080/api/etraps", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ etrap: newEtrap }),
    })
      .then((res) => res.json())
      .then((added) => setEtraps((p) => [...p, added]))
      .catch(console.error);
    setNewEtrap("");
  };

  const deleteEtrap = (id) => {
    fetch("http://localhost:8080/api/etraps/" + id, {
      method: "DELETE",
    }).then(() => setEtraps((p) => p.filter((e) => e.id !== id)));
  };

  const startEdit = (etrap) => {
    setEditPk(etrap.id);
    setEditName(etrap.etrap);
  };

  const saveEdit = (pk) => {
    fetch('http://localhost:8080/api/etraps/' + pk, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ etrap: editName }),
    })
    .then(res => res.json())
    .then(updated => {
        setEtraps(etraps.map(e => e.id === pk ? updated : e));
        setEditPk(null);
        setEditName('');
    })
  }

  return (
    <div>
      <label>
        New etrap:
        <input
          type="text"
          onChange={(e) => setNewEtrap(e.target.value)}
          value={newEtrap}
        />
      </label>
      <button onClick={addNewEtrap} disabled={!newEtrap.trim()}>Add</button>
      <ul>
        {etraps.map((etrap) => (
          <li key={etrap.id}>
            {editPk === etrap.id ? (
              <>
                <input
                  type="text"
                  ref={editInputRef} // üîπ –ü—Ä–∏–≤—è–∑–∫–∞ —Å—Å—ã–ª–∫–∏
                  onChange={(e) => setEditName(e.target.value)}
                  value={editName}
                />
                <button onClick={() => saveEdit(etrap.id)} >Save</button>
                <button onClick={(e) =>  setEditPk(null)}>Cancel</button>
              </>
            ) : (
              <>
                {etrap.etrap}
                <button onClick={() => startEdit(etrap)}>Edit</button>
                <button onClick={() => deleteEtrap(etrap.id)}>Delete</button>
              </>
            )}
          </li>
        ))}
      </ul>
    </div>
  );
};

export default AdminEtraps;

